<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Weather Summary</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <a href="/">
            <button class="btn">Back</button>
        </a>
        <h1>Daily Weather Summary</h1>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>City</th>
                    <th>Average Temperature (°C)</th>
                    <th>Maximum Temperature (°C)</th>
                    <th>Minimum Temperature (°C)</th>
                    <th>Dominant Condition</th>
                </tr>
            </thead>
            <tbody>
                {% for data in summary %}
                <tr>
                    <td>{{ data.date }}</td>
                    <td>{{ data.city }}</td>
                    <td>{{ data.average_temp }}</td>
                    <td>{{ data.max_temp }}</td>
                    <td>{{ data.min_temp }}</td>
                    <td>{{ data.dominant_condition }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div id="alert-section">
            <!-- Section for displaying alerts (if implemented) -->
        </div>

        <!-- Chart Section for Daily Summary -->
        <div id="chart-container">
            <canvas id="dailySummaryChart"></canvas>
        </div>

        <!-- Bar Chart for Dominant Weather Conditions -->
        <div id="dominant-condition-chart-container" style="margin-top: 40px;">
            <canvas id="dominantConditionChart"></canvas>
        </div>
    </div>

    <script>
        // Prepare data for the daily summary chart
        const dailySummary = {{ summary | tojson }};
        const dates = dailySummary.map(data => data.date);
        const averageTemps = dailySummary.map(data => data.average_temp);
        const maxTemps = dailySummary.map(data => data.max_temp);
        const minTemps = dailySummary.map(data => data.min_temp);

        // Line Chart for Average, Max, and Min Temperatures
        const ctx2 = document.getElementById('dailySummaryChart').getContext('2d');
        const dailySummaryChart = new Chart(ctx2, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    {
                        label: 'Average Temperature (°C)',
                        data: averageTemps,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        fill: false
                    },
                    {
                        label: 'Maximum Temperature (°C)',
                        data: maxTemps,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        fill: false
                    },
                    {
                        label: 'Minimum Temperature (°C)',
                        data: minTemps,
                        borderColor: 'rgba(153, 102, 255, 1)',
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Daily Temperature Summary'
                    },
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Temperature (°C)'
                        }
                    }
                }
            }
        });

        // Prepare data for the dominant weather conditions chart
        const conditionCounts = {};
        dailySummary.forEach(data => {
            if (conditionCounts[data.dominant_condition]) {
                conditionCounts[data.dominant_condition]++;
            } else {
                conditionCounts[data.dominant_condition] = 1;
            }
        });

        const conditions = Object.keys(conditionCounts);
        const conditionValues = conditions.map(condition => conditionCounts[condition]);

        // Bar Chart for Dominant Weather Conditions
        const ctx3 = document.getElementById('dominantConditionChart').getContext('2d');
        const dominantConditionChart = new Chart(ctx3, {
            type: 'bar',
            data: {
                labels: conditions,
                datasets: [{
                    label: 'Count of Dominant Weather Conditions',
                    data: conditionValues,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Dominant Weather Conditions'
                    },
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Count'
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
